{
    email {$EMAIL}
    acme_dns cloudflare "{$CF_API_TOKEN}"
    debug
}

*.{$DOMAIN} {

  tls {
      dns cloudflare "{$CF_API_TOKEN}"
      resolvers 1.1.1.1
  }

  @jellyfin host jellyfin.{$DOMAIN}
  handle @jellyfin {
    reverse_proxy 10.10.10.162:8096
  }

  @komodo host komodo.{$DOMAIN}
  handle @komodo {
    reverse_proxy komodo-core-1:9120
  }

  @immich host immich.{$DOMAIN}
  handle @immich {
    reverse_proxy 10.10.10.163
  }

  @storage host storage.{$DOMAIN}
  handle @storage {
    reverse_proxy 10.10.10.8:80
  }

  @router host router.{$DOMAIN}
  handle @router {
    reverse_proxy 10.10.10.1:443
  }

  handle {
    abort
  }

  log {
    output stdout
    format console
  }
}